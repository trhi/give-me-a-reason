<!DOCTYPE html>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<html lang="en-us">
  <head>
      
    <!-- define character encoding: utf-8 -->
    <meta charset="utf-8">
    
    
   <!-- add metadata regarding keywords of project/site/button?
   <meta name="keywords" content="refugees welcome, migrants, european union, germany, altruism, volunteers, i help because, helping others"> 
    -->   
    
    <!-- define: to cater to needs of IE9 and IE8 
    and specify: google chrome frame should start if installed -->
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <!-- define responsive design: w3.css -->
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">

    <style>
    #givemeareasonbutton {
    width: 300px;
    height: 300px;
    border-radius: 50%;
    background-image: url(images/give-me-a-reason-ms.png);
    background-repeat: no-repeat;
    border: none;
    cursor: pointer;
    }

    #givemeareasonbutton:disabled{
    opacity: 0.6;
    cursor: url(images/Sun_symbol.svg), wait;
    }
    
    /* would be nice to implement this..
    that the button says "loading voices" and is disabled
    until the data has finished loading from the .json files
    #givemeareasonbutton:loading{
    opacity: 0.4;
    background-image: url(images/give-me-a-reason-loading-voices.png);
    cursor: url(images/Sun_symbol.svg), wait;
    }*/

   
    </style>   
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    
    <title>Give Me a Reason
    </title>

  </head>
  <body>

       <audio id="help/">
            <source src="audio/de/other/f03o.mp3" type="audio/mp3">
       </audio>
      
       <audio id="subject/">
           <source src="audio/de/other/f03o.mp3" type="audio/mp3"> 
       </audio>
       
       <audio id="verb/">
            <source src="audio/de/other/f03o.mp3" type="audio/mp3">
       </audio>
       
       <audio id="object/">
            <source src="audio/de/other/f03o.mp3" type="audio/mp3">
       </audio>
      
      <audio id="test">
            <source src="audio/de/other/f03o.mp3" type="audio/mp3">
       </audio>
      
      <form>
            <button type="button" id="givemeareasonbutton"
                onclick="giveMeAReason()" ></button>     
      </form>

     
      <div id="sentencesdiv">
            <p id="demo"></p>            
      </div>
      
      


    <script>


        //for json implementation
        //in order to assign an id value for the p element per sentence created per session
        //to begin with, it is 0. But the script will add 1 per sentence
        var pInteger;
        //This is to create an array of the sentences/data generated per session
        //This array is also used for playing back sentences which the user chooses to click on
        //var sentencesArray = [];
        
        //global variable personsurl = .json file with list of all participating voices/datasets
        var personsurl = "audio/de/de-persons-test.json";
        //global variable persons, this is the object containing all the persons
        //eg. persons[0].name or persons[0].path
        var data;
        var person0;
        var person1;
        var person2;
        var person3;
        
        //call the function
        //disableButton();
        document.getElementById("givemeareasonbutton").disabled = true;  
        loadData(loadPersons);
        //this is also undefined, because loadData() is or contains 
        //an async function.
        //The Javascript engine is immediately continuing
        //in a synchronous manner, to execute the innerHTML command,
        //but it will necessarily return undefined because
        //the async function has not yet been evaluated
        //document.getElementById("demo").innerHTML = data.toString() + " <br>" +
         //                   data.persons[0].path + "<br>" + data.persons[1].path;
       // loadPersons();
        
        //this is the function
        function loadData(callback){
            
            //wish i could tweak the css to show "loading voices" while loading..
            //document.getElementById("givemeareasonbutton").loading;
            
            //document.getElementById("demo").innerHTML = "hello world";
            //should be loading personsObject here
            //and also Object for each person..
            var xmlhttp = new XMLHttpRequest();
            
           // var personsurl = "audio/de/de-persons-test.json";

            //this creates the persons array, given the persons url
            //well, or this is the async code, rather..
            xmlhttp.open("GET", personsurl, true);
            xmlhttp.send();
            
            //this is asynchronous code
            xmlhttp.onreadystatechange = function() {
                if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
                    //this is synchronous code
                    data = JSON.parse(xmlhttp.responseText);
                    //this is illegal in javascript, an asynchronous function cannot return:
                    //return data;
                    //document.getElementById("demo").innerHTML = "hello world";
                  //  document.getElementById("demo").innerHTML = data.toString() + " <br>" +
                    //        data.persons[0].path + "<br>" + data.persons[1].path;
                    //loadPersons(data);
                    callback();
                    
                }
            }; 
        }
           
            
            
            function loadPersons(){
                
                document.getElementById("demo").innerHTML = "hello again";
                
                
            
               // document.getElementById("demo").innerHTML = data.persons[0].name + "  " + data.persons[1].path
               // + " And the length of the array is: " + data.persons.length;
                //document.getElementById("demo").innerHTML = "hello again";
            
                //var i;
                
                        //the reason that data is undefined is because the loadpersons() function
                        //is an async function and it has not yet had time enough to load
                        var xmlhttp1 = new XMLHttpRequest();
                        xmlhttp1.open("GET", data.persons[0].path, true);
                        xmlhttp1.send();
                        
                        xmlhttp1.onreadystatechange = function() {
                            if (xmlhttp1.readyState === 4 && xmlhttp1.status === 200) {
       
                                person0 = JSON.parse(xmlhttp1.responseText);
                                //document.getElementById("demo").innerHTML = "hello again";
                                //callback function would go here..
                                //how to create something that iterates through
                                //all the entries in data.persons[]??? 
                                showresults(person0);
                                 //assign the person to the array at position i..?
                                
                            }
                        };
                        
                        var xmlhttp2 = new XMLHttpRequest();
                        xmlhttp2.open("GET", data.persons[1].path, true);
                        xmlhttp2.send();
                        
                        xmlhttp2.onreadystatechange = function() {
                            if (xmlhttp2.readyState === 4 && xmlhttp2.status === 200) {
       
                                person1 = JSON.parse(xmlhttp2.responseText);
                                //document.getElementById("demo").innerHTML = "hello 3rd time";
                                //data.persons.push(person);
                                
                                showresults(person1);
                                 //assign the person to the array at position i..?
                                enableButton();
                                
                            }
                        };
                        
                    
                    
                }
                         
                
                function showresults(person){
                    
                    document.getElementById("demo").innerHTML = "The person object has: " 
                        + person.toString() + "<br>"
                        + person.path + "<br>"
                        + person.full[1].filename;

                    }
                
                function enableButton(){
                    document.getElementById("givemeareasonbutton").disabled = false;
                }
                
            
            
                  
            
            
            
            // document.getElementById("demo").innerHTML = data.persons[0].name;
            
            //And it works!! Yuhhuu!!
            //document.getElementById("demo").innerHTML = personsObject.persons[1].name + "  " + personsObject.persons[1].path;

            //this function iterates through the persons array
            //and creates an object for each person given the path
           
            
            
    
            //document.getElementById("demo").innerHTML = data.persons[0].name;
            
            
            
        
        
        
        
          //var persons is a global variable = array of the current voices recorded
          //var persons = ["k","h","t","f","s"];
          //var persons = ["k","h","t","f","s"];
          //var audiopath gives the path where you find all the files
          //var audiopath = "audio/de/";
          //var mp3 for concatenation later on (need this be global? or just inside playAudio function?)
          //var mp3 = ".mp3";

          //var typeIndex starts at 0 and gets +1 everytime we go through one playAudio()
          //var typeIndex = 0; //global counter variable
          //var types is an array of the type of audio in question, this is used for 
          //concatenating the path of the audio source file later on
          //main purpose in this data structure solution is to create single 
          //playAudio() function ie. reuse code as much as possible.
          //var types = ["help/", "subject/", "object/", "verb/"];
          
    
          //toggles the button state = enabled or disabled depending on whether audio is playing
          //and the best part is that this function actually works! Hurray!
          function toggleButtonState(){
                if (document.getElementById("givemeareasonbutton").disabled === false) {
                     document.getElementById("givemeareasonbutton").disabled = true;
                }else{
                    document.getElementById("givemeareasonbutton").disabled = false;
                }
           }
                    
          //this function generates a randomIndex given a min and max value
          //the max value should be the length of the array, min should be zero?
          function randomIndex(min, max){
              
              //this function will work for the .json datamodel
              
              //standard means to choose random number between max (excluded) and min (included)
              //max is exluded because max is given as the length of the array
              //and min is given as 0.
              //ie. if length = 2, there are indeces 0 and 1, not 0, 1 and 2.
              //ugh, except this mucks up the generating for the chooserandom index
              //for the recordings themselves..
              //ie. take care of the 0 array index issue in choosePerson()
              //return Math.floor(Math.random() * (max - min + 1)) + min;
                //
                
               //function getRandomIntInclusive(min, max) {
               // return Math.floor(Math.random() * (max - min + 1)) + min;
               //
              return Math.floor((Math.random() * max - min + 1) + min);
              //return Math.floor(Math.random() * (max - min)) + min;
              
          }
          
          //chooses a person, ie. chooses random person from a list of persons
          function choosePerson(){             
            // var persons is an array of strings/characters..  
            //var persons = ["k","h","t","f","s"];
            //var randomIndex is an integer
            //function chooseIndex(min, max) generates a random number between max inclusive and min inclusive
            var index = randomIndex(1, persons.length);
            //to correct for random number generator
            var index = index - 1;
            return persons[index];
            }
     
    
          //generates a random help utterance given a person
          //each person has a different maximum number of utterances available
          //grr.. although I wanted each to have 8 and 8 only..
          //or should i call this by saying: persons[randomIndex]
          function chooseIndex(person){              
              if(person.match(/k/)){
                  return randomIndex(1,12);               
              }
              if(person.match(/s/)){                  
                  return randomIndex(1,9);                  
              }              
              if(person.match(/t/)){                  
                  return randomIndex(1,8);                  
              }
              if(person.match(/f/)){                  
                  return randomIndex(1,7);                  
              }
              if(person.match(/h/)){                  
                  return randomIndex(1,6);                  
              }            
          }
 
    
          //creates a string version of the index (for later path concatenation
          function chooseStringIndex(person){
            var index = chooseIndex(person);
              if(index < 10){             
                  var zero = "0";
                  return zero.concat(index.toString());                 
              }else{                               
                  return index.toString();                 
              }        
          }

            //concatenates the src/path+filename
            //given the person = a letter,
            //index of the audiofile in string form,
            //and by taking the first letter of the category, eg. help = h
            //and then creating the filename: eg. k+01+h+.mp3
            //and then creating the full source using "audiopath"/string ie. audio/de/ 
            //and the type from the types array eg. help/
            //and finally, the filename eg. k001h.mp3
            function createSource(typeIndex){                
                  var person = choosePerson();
                  var index = chooseStringIndex(person);
                  //does this way of calling it work?
                  var category = types[typeIndex].substring(0,1);
                  var filename = person.concat(index, category, mp3);
                  return audiosrc = audiopath.concat(types[typeIndex], filename);
            }
       
       
          
    function giveMeAReason(){
            
      //first, toggle button state: disable the button while audio is playing
      // for some reason it doesnt pick up on this command when its place here..
      toggleButtonState(); 
      
    
    //gets the x.json file and creates an object out of it.
    //Create multiple Objects, for each person?
    //Given the persons.json file?
    //Then: simply choose from an array of persons[0-16]
    //eg. persons[x].path = pathname;
    //eg. persons[x].help[y].filename;
    //pathname += filename;
    //blabla.src = pathname;
    var xmlhttp = new XMLHttpRequest();
    var personurl = "audio/de/h/h.json";

    xmlhttp.onreadystatechange = function() {
     if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
            var personObject = JSON.parse(xmlhttp.responseText);
          myFunction(personObject);
     }
    };
    xmlhttp.open("GET", personurl, true);
    xmlhttp.send();
    
    function myFunction(person) {
        var out = "";
        var i;
        
        
        //In fact, first first, assign the src of a full recording to an audioelement
        //and play that audioelement back 
        //Works!! Success!!
        /*
        var fullpath = person.path;
        fullpath += person.full[0].filename;
        document.getElementById("test").src = fullpath;
        //And then play that file!
        //Works!! Success!!
        document.getElementById("test").play();
        */
        
        //Now get it to choose a random full recording..
        //ie. given one person, choose random, assign source, playback
        //Works!! Success!!
        var fullpath = person.path;
        
        //go into the whole cycle of:
        //1. choose person
        //2. then choose help
        //3. choose person
        //4. then choose subject..
        //... etc.
        var randomPerson = getRandomIndex(0, persons.length);
       
       /*
        var randomIndex = getRandomIndex(0, person.full.length);
        fullpath += person.full[randomIndex].filename;
        
        document.getElementById("test").src = fullpath;
        document.getElementById("test").play();
        
        document.getElementById("demo").innerHTML = person.full[randomIndex].de;
        */
        
        //Now get it to put together a random sentence..
        //ie. given one person, choose random help, subject, object, verb
        //Am now commenting out the rest of the code below that would otherwise choose the stuff..
        var randomHelp = getRandomIndex(0, person.help.length);
        var randomSubject = getRandomIndex(0, person.subject.length);
        var randomObject = getRandomIndex(0, person.object.length);
        var randomVerb = getRandomIndex(0, person.verb.length);
        
        toggleButtonState();
        
        //create new <p> element
        //which is an empty string (node)
        //create a counter.. pInteger. 
        //toString so that the id of the newly created p
        //equals the value of the "counter"
        //the id can later be retrieved and thereby also the sentence.
        
        //This works!  
        if(pInteger === undefined){
            pInteger = 0;
        }
        var pIndex = pInteger.toString();
        var newsentence = document.createElement("p");
        var textNode = document.createTextNode("");
        newsentence.appendChild(textNode);
        newsentence.setAttribute("id", pIndex);
        
       
       
        //increment in preparation for next sentence
        pInteger = pInteger + 1;
        
        /*
        //set the onclick event using jQuery
        $("p").click(function() {
            alert("Hello World");
        });
        */
        /*
        //or javascript?
        document.getElementById(newsentence.id).onclick = function() {
            $(newsentence.id).append(" <--- This was just clicked!!");
        };*/
        
        
        //prepend the new p element to the already existing peas.
        //Yay! This works! Success!!
        $("p").prepend(newsentence);
        
        //Choose random person/path before selecting each audio element
        
        
        
        fullpath += person.help[randomHelp].filename;
        document.getElementById("help/").src = fullpath;
        document.getElementById("help/").preload; 
        
        fullpath = person.path;
        fullpath += person.subject[randomSubject].filename;
        document.getElementById("subject/").src = fullpath;
        document.getElementById("subject/").preload;
        
        fullpath = person.path;
        fullpath += person.object[randomObject].filename;
        document.getElementById("object/").src = fullpath;
        document.getElementById("object/").preload;
        
        fullpath = person.path;           
        fullpath += person.verb[randomVerb].filename;
        document.getElementById("verb/").src = fullpath;
        document.getElementById("verb/").preload;
        
        
        
        document.getElementById("help/").play();
        //should always be generating a new <p> to which to add it, 
        //the other ones should still be visible below..
        //document.getElementById("demo").innerHTML = person.help[randomHelp].de;
        $(newsentence).append(person.help[randomHelp].de);
        
     
        
        
        //declare sentencesArray as a global variable var sentencesArray = [];
        //add the data per step to the array
        //sentences is an array of sentence -objects
        //declare object sentence
        //sentence.pIndex starts at 0.
        //sentence.help
        //sentence.help.person
        //sentence.help.help
        //etc.
        
        
        //sentencesArray.addElem
        
        document.getElementById("help/").onended = function playSubject(){
        
         
        document.getElementById("subject/").play();
        //document.getElementById("demo").innerHTML = person.subject[randomSubject].de;
        $(newsentence).append(" " + person.subject[randomSubject].de);
        document.getElementById("subject/").onended = function playObject(){
          

            document.getElementById("object/").play();
            //document.getElementById("demo").innerHTML = person.object[randomObject].de;
            $(newsentence).append(" " + person.object[randomObject].de);
            document.getElementById("object/").onended = function playVerb(){
            
                 
                 document.getElementById("verb/").play();
                 //document.getElementById("demo").innerHTML = person.verb[randomVerb].de;
                 $(newsentence).append(" " + person.verb[randomVerb].de);
                 //$("#demo").prepend('<p></p>');
                 
                 //try to see if it will display the sentencenumber..
                 //Yus!! Success!! This works.
                 //It means that the p called newsentence is assigned an id value
                 // $(newsentence).append(" Sentence No.: " + newsentence.id);
                 
                 
                 //now follows a long list of remnants of code where I was trying
                 //trying to get the system to give me reliable feedback about which p 
                 //was being clicked..
                 //to no avail..
                 //abort mission (for today)
                 //attempt at implementing assigning function onclick to each p element created
                 //I will probably need to implement closures here..
                 //document.getElementById(pIndex).onclick = function() {
               //     $(pIndex).append(" <--- This was just clicked!!");
                //};
                
                /*
                newsentence.onclick = pClick(this);
                
                function pClick(element){
                    
                    element.innerHTML = " <--- This was just clicked!!";
                    //$(element).append(" <--- This was just clicked!!");
                }
                */
                /*
                function otherfunction(){
                    
                     $(this).append(" <--- This was just clicked!!");
                };*/
                
                /*
                <p id="demo" onclick="myFunction(this, 'red')">Click me to change my text color.</p>

        <script>
        function myFunction(elmnt,clr) {
           elmnt.style.color = clr;
        }
        */
                
                
                /*$(document).ready(function() {
                    $(pIndex).click(clickP);
                });
                
                function clickP(){
                    $(this).append(" <--- This was just clicked!!");
                };*/
                
                 
                 document.getElementById("verb/").onended = toggleButtonState();
             };
        
        };
        
    };
    
        
        

        
        // Returns a random integer between min (included) and max (excluded)
        // Using Math.round() will give you a non-uniform distribution!
        //pass zero as min and pass array.length as max
        //eg. 0 and 5
        //will return: 0, 1, 2, 3 or 4.
        //these are all valid indeces of the array
        function getRandomIndex(min, max) {
             return Math.floor(Math.random() * (max - min)) + min;
        }
        
        
        
        
        /*
        //json to object works!
        //calling the object attributes works!
        //calling the attributes of the objects contained in the array works!
        out += "The first big test!" + "<br>";
        out += document.getElementById("test").src + "<br><br><br>";
        out += person.name + "<br>";
        out += person.path + "<br>";
        out += person.workshop + "<br>";
        out += person.full[0].filename;
        document.getElementById("demo").innerHTML = out;
        
  
        //This prints out all the filenames and de texts that there are.
        for(i = 0; i < person.full.length; i++) {
          out += "Filename is: " + person.full[i].filename + "<br> And in german it says: " + 
             person.full[i].de + '</a><br>';
        document.getElementById("demo").innerHTML = out;
        }
        */
       
        
    }
      
      
      /*  
      //givemeareason code  
      document.getElementById(types[typeIndex]).src = createSource(typeIndex);
      document.getElementById(types[typeIndex]).load();
      loadSubject();
       
        function loadSubject(){
            document.getElementById(types[typeIndex+1]).src = createSource(typeIndex+1);
            document.getElementById(types[typeIndex+1]).load();
            loadObject();

                    function loadObject(){                            
                            document.getElementById(types[typeIndex+2]).src = createSource(typeIndex+2);
                            document.getElementById(types[typeIndex+2]).load();
                            loadVerb();
   
                                function loadVerb(){
                                        document.getElementById(types[typeIndex+3]).src = createSource(typeIndex+3);
                                        document.getElementById(types[typeIndex+3]).load();
                                }
                    }
        }
        document.getElementById(types[typeIndex]).play();
        //document.getElementById(types[typeIndex]).onended = function(){            
           //this works setTimeout(function(){document.getElementById(types[typeIndex+1]).play();}, 1000);
          //  };
        document.getElementById(types[typeIndex]).onended = function(){   
              document.getElementById(types[typeIndex+1]).play();
              document.getElementById(types[typeIndex+1]).onended = function(){
                   document.getElementById(types[typeIndex+2]).play();
                   document.getElementById(types[typeIndex+2]).onended = function(){
                       document.getElementById(types[typeIndex+3]).play();
                       document.getElementById(types[typeIndex+3]).onended = function(){
                           document.getElementById(types[typeIndex]).onended = toggleButtonState();
                       };
                   };
              };
              
          };
          */
         //and copying toggleButtonState(); here below..
         toggleButtonState();
          
    }

    </script>
      
    
    
    <!-- cope with screen rotations and scaling-->
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
