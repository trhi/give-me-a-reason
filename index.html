<!DOCTYPE html>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<html lang="en-us">
  <head>
      
    <!-- define character encoding: utf-8 -->
    <meta charset="utf-8">
    
    
   <!-- add metadata regarding keywords of project/site/button?
   <meta name="keywords" content="refugees welcome, refugee crisis, european union, germany, altruism, i help because, helping others"> 
    -->   
    
    <!-- define: to cater to needs of IE9 and IE8 
    and specify: google chrome frame should start if installed -->
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <!-- define responsive design: w3.css -->
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">

    <style>
    #givemeareasonbutton {
    width: 300px;
    height: 300px;
    border-radius: 50%;
    background-image: url(images/give-me-a-reason-ms.png);
    background-repeat: no-repeat;
    border: none;
    cursor: pointer;
    }

    #givemeareasonbutton:disabled{
    opacity: 0.6;
    cursor: url(images/Sun_symbol.svg), wait;
    }

    </style>   
    
    <title>Give Me a Reason
    </title>

  </head>
  <body>

     
            <audio id="pause">
              <source src="audio/de/other/f03o.mp3" type="audio/mp3">
            Your browser does not support the audio element.
            </audio>
      
       <audio id="help/">
              <source src="audio/de/other/f03o.mp3" type="audio/mp3">
      Your browser does not support the audio element.
       </audio>
      
       <audio id="subject/">
           <source src="audio/de/other/f03o.mp3" type="audio/mp3">
         
       </audio>
       
       <audio id="verb/">
           <source src="audio/de/other/f03o.mp3" type="audio/mp3">
         
       </audio>
       
       <audio id="object/">
           <source src="audio/de/other/f03o.mp3" type="audio/mp3">
         
       </audio>
      
         <audio id="x/">
           <source src="audio/de/other/f03o.mp3" type="audio/mp3">
         
       </audio>
       
       
      
      <form>
          <button type="button" id="givemeareasonbutton"
                
                  onclick="giveMeAReason()" ></button>
                  
     <!--implement this later: ondblclick="playAudio("x", 99, typeIndex[4])"-->
     
  </form>

      <p id="demo"></p>


      <script>
    
          //var persons is a global variable = array of the current voices recorded
          //var persons = ["k","h","t","f","s"];
          var persons = ["k","h","t","f","s"];
          //var audiopath gives the path where you find all the files
          var audiopath = "audio/de/";
          //var mp3 for concatenation later on (need this be global? or just inside playAudio function?)
          var mp3 = ".mp3";

          //var typeIndex starts at 0 and gets +1 everytime we go through one playAudio()
          var typeIndex = 0; //global counter variable
          //var types is an array of the type of audio in question, this is used for 
          //concatenating the path of the audio source file later on
          //main purpose in this data structure solution is to create single 
          //playAudio() function ie. reuse code as much as possible.
          var types = ["help/", "subject/", "object/", "verb/"];
          
    
          //toggles the button state = enabled or disabled depending on whether audio is playing
          //and the best part is that this function actually works! Hurray!
          function toggleButtonState(){
                if (document.getElementById("givemeareasonbutton").disabled === false) {
                     document.getElementById("givemeareasonbutton").disabled = true;
                }else{
                    document.getElementById("givemeareasonbutton").disabled = false;
                }
           }
                    
          //this function generates a randomIndex given a min and max value
          //the max value should be the length of the array, min should be zero?
          function randomIndex(min, max){
              
              //this function will work for the .json datamodel
              
              //standard means to choose random number between max (excluded) and min (included)
              //max is exluded because max is given as the length of the array
              //and min is given as 0.
              //ie. if length = 2, there are indeces 0 and 1, not 0, 1 and 2.
              //ugh, except this mucks up the generating for the chooserandom index
              //for the recordings themselves..
              //ie. take care of the 0 array index issue in choosePerson()
              //return Math.floor(Math.random() * (max - min + 1)) + min;
              /*
               * 
               * function getRandomIntInclusive(min, max) {
                        return Math.floor(Math.random() * (max - min + 1)) + min;
               */
              return Math.floor((Math.random() * max - min + 1) + min);
              //return Math.floor(Math.random() * (max - min)) + min;
              
          }
          
          //chooses a person, ie. chooses random person from a list of persons
          function choosePerson(){             
            // var persons is an array of strings/characters..  
            //var persons = ["k","h","t","f","s"];
            //var randomIndex is an integer
            //function chooseIndex(min, max) generates a random number between max inclusive and min inclusive
            var index = randomIndex(1, persons.length);
            //to correct for random number generator
            var index = index - 1;
            return persons[index];
            
              
          }
     
    
          //generates a random help utterance given a person
          //each person has a different maximum number of utterances available
          //grr.. although I wanted each to have 8 and 8 only..
          //or should i call this by saying: persons[randomIndex]
          function chooseIndex(person){              
              if(person.match(/k/)){
                  return randomIndex(1,12);               
              }
              if(person.match(/s/)){                  
                  return randomIndex(1,9);                  
              }              
              if(person.match(/t/)){                  
                  return randomIndex(1,8);                  
              }
              if(person.match(/f/)){                  
                  return randomIndex(1,7);                  
              }
              if(person.match(/h/)){                  
                  return randomIndex(1,6);                  
              }            
          }
 
    
          //creates a string version of the index (for later path concatenation
          function chooseStringIndex(person){
            var index = chooseIndex(person);
              if(index < 10){             
                  var zero = "0";
                  return zero.concat(index.toString());                 
              }else{                               
                  return index.toString();                 
              }        
          }

            //concatenates the src/path+filename
            //given the person = a letter,
            //index of the audiofile in string form,
            //and by taking the first letter of the category, eg. help = h
            //and then creating the filename: eg. k+01+h+.mp3
            //and then creating the full source using "audiopath"/string ie. audio/de/ 
            //and the type from the types array eg. help/
            //and finally, the filename eg. k001h.mp3
            function createSource(typeIndex){                
                  var person = choosePerson();
                  var index = chooseStringIndex(person);
                  //does this way of calling it work?
                  var category = types[typeIndex].substring(0,1);
                  var filename = person.concat(index, category, mp3);
                  return audiosrc = audiopath.concat(types[typeIndex], filename);
            }
       
          
    function giveMeAReason(){
            
      //first, toggle button state: disable the button while audio is playing
      // toggleButtonState();  
      toggleButtonState(); 
        
      document.getElementById(types[typeIndex]).src = createSource(typeIndex);
      document.getElementById(types[typeIndex]).load();
      loadSubject();
       
        function loadSubject(){
            document.getElementById(types[typeIndex+1]).src = createSource(typeIndex+1);
            document.getElementById(types[typeIndex+1]).load();
            loadObject();

                    function loadObject(){                            
                            document.getElementById(types[typeIndex+2]).src = createSource(typeIndex+2);
                            document.getElementById(types[typeIndex+2]).load();
                            playVerb();
   
                                function loadVerb(){
                                        document.getElementById(types[typeIndex+3]).src = createSource(typeIndex+3);
                                        document.getElementById(types[typeIndex+3]).load();
                                }
                    }
        }
        document.getElementById(types[typeIndex]).play();
        //document.getElementById(types[typeIndex]).onended = function(){            
           //this works setTimeout(function(){document.getElementById(types[typeIndex+1]).play();}, 1000);
          //  };
        document.getElementById(types[typeIndex]).onended = function(){   
              document.getElementById(types[typeIndex+1]).play();
              document.getElementById(types[typeIndex+1]).onended = function(){
                   document.getElementById(types[typeIndex+2]).play();
                   document.getElementById(types[typeIndex+2]).onended = function(){
                       document.getElementById(types[typeIndex+3]).play();
                       document.getElementById(types[typeIndex+3]).onended = function(){
                           document.getElementById(types[typeIndex]).onended = toggleButtonState();
                       };
                   };
              };
              
          };
          
         
        //some code to try to get the audio to run smoothly..
        //document.getElementById(types[typeIndex+1]).onended = setTimeout(function(){document.getElementById(types[typeIndex+2]).play();}, 1000);  
        //setTimeout(function(){document.getElementById(types[typeIndex+3]).play();}, 1000);
        
        
       // document.getElementById("pause").play();
       // document.getElementById("pause").play();
       // document.getElementById("pause").play();
       // document.getElementById("pause").play();
        //document.getElementById(types[typeIndex+1]).play();
           // document.getElementById(types[typeIndex+1]).play();
        
       // document.getElementById(types[typeIndex+1]).onended = document.getElementById(types[typeIndex+2]).play();
       // document.getElementById(types[typeIndex+2]).onended = document.getElementById(types[typeIndex+3]).play();


        //document.getElementById(types[typeIndex+2]).play();
        //document.getElementById(types[typeIndex+3]).play();
       // document.getElementById(types[typeIndex+3]).onended = toggleButtonState();
        
        // this was cut out document.getElementById(types[typeIndex]).onended = toggleButtonState();
       
                //again, an attempt to get the audio to run smoothly..
        /*
         * audio[0].onended=function(){
        setTimeout(function(){
         audio[1].play()
        ;}, 2000);
        };
        */
        
        
        
    }


    


    
    </script>
      
    
    
    <!-- cope with screen rotations and scaling-->
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
